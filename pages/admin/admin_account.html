<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Account - UMak ECP</title>
  <style>
    /* GLOBAL STYLES (Matching Admin Theme) */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Century Gothic', sans-serif; }
    body { background-color: #f4f5f7; min-height: 100vh; display: flex; flex-direction: column; }

    /* NAV */
    nav { background-color: #022d6d; display: flex; align-items: center; justify-content: space-between; padding: 10px 40px; position: sticky; top: 0; z-index: 1000; }
    .navbar-left { display: flex; align-items: center; gap: 15px; color: white; font-size: 16px; }
    .navbar-left img { height: 40px; }
    .navbar-links { list-style: none; display: flex; gap: 25px; }
    .navbar-links li a { text-decoration: none; color: white; padding: 10px 20px; border-radius: 3px; transition: 0.3s; }
    .navbar-links li a:hover, .navbar-links li a.active-link { background-color: #f36b00; color: white; }
    
    /* Account/Logout Group */
    .nav-right { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }
    .logout-btn { background-color: #f30000; color: white; border: none; border-radius: 4px; padding: 8px 20px; cursor: pointer; font-size: 12px; }
    .account-btn { background: none; border: none; color: #ccc; font-size: 11px; cursor: pointer; text-decoration: underline; }
    .account-btn:hover { color: white; }

    /* MAIN */
    main { flex: 1; padding: 40px 60px; display: flex; justify-content: center; }
    
    .account-container { background: white; width: 100%; max-width: 600px; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .form-header { border-bottom: 2px solid #f36b00; margin-bottom: 30px; padding-bottom: 10px; }
    .form-header h2 { color: #022d6d; }

    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
    .form-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
    .form-group input[readonly] { background-color: #f9f9f9; cursor: not-allowed; color: #666; }
    
    .section-title { font-size: 14px; color: #022d6d; font-weight: bold; margin: 25px 0 15px; text-transform: uppercase; border-bottom: 1px solid #eee; padding-bottom: 5px; }

    .btn-save { background-color: #022d6d; color: white; border: none; padding: 12px 30px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 14px; width: 100%; transition: 0.3s; }
    .btn-save:hover { background-color: #00328f; }

    /* ALERT */
    .alert { padding: 15px; margin-bottom: 20px; border-radius: 4px; display: none; }
    .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

    footer { background-color: #242424; color: #f36b00; padding: 30px; text-align: center; margin-top: auto; }
  </style>
</head>
<body>

  <nav>
    <div class="navbar-left">
      <img src="../../images/UMAK LOGO.png" alt="UMak Logo">
      <span>University of Makati - ECP</span>
    </div>
    <ul class="navbar-links">
      <li><a href="admin_dashboard.html">Dashboard</a></li>
      <li><a href="admin_students.html">Students</a></li>
      <li><a href="admin_events.html">Events</a></li>
      <li><a href="admin_venues.html">Venues</a></li>
      <li><a href="admin_messages.html">Messages</a></li>
    </ul>
    <div class="nav-right">
        <button class="logout-btn" onclick="logout()">Logout</button>
        <button class="account-btn" onclick="window.location.href='admin_account.html'">My Account</button>
    </div>
  </nav>

  <main>
    <div class="account-container">
        <div class="form-header">
            <h2>Manage Account</h2>
            <p style="color:#666; font-size:13px;">Update your contact details and password.</p>
        </div>

        <div id="alertBox" class="alert"></div>

        <form id="accountForm">
            <div class="section-title">Profile Information</div>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="fullName" readonly>
            </div>
            <div class="form-group">
                <label>Employee ID</label>
                <input type="text" id="empId" readonly>
            </div>
            <div class="form-group">
                <label>Department</label>
                <input type="text" id="dept" readonly>
            </div>
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="email" name="email">
            </div>
            <div class="form-group">
                <label>Contact Number</label>
                <input type="text" id="contact" name="contact_number">
            </div>

            <div class="section-title">Security</div>
            <div class="form-group">
                <label>New Password <span style="font-weight:normal; font-size:12px; color:#888;">(Leave blank to keep current)</span></label>
                <input type="password" id="newPass" name="new_password" placeholder="8+ chars, Upper, Number, Special">
            </div>
            
            <div class="form-group">
                <label>Current Password <span style="color:red;">*</span></label>
                <input type="password" id="currentPass" name="current_password" required placeholder="Required to save changes">
            </div>

            <button type="submit" class="btn-save">Save Changes</button>
        </form>
    </div>
  </main>

  <footer>
    <p>Â© 2025 University of Makati - Event Coordination Portal</p>
  </footer>

  <script>
    const API_BASE = '../../api';
    const session = JSON.parse(localStorage.getItem('user_session'));

    if(!session || session.user_type !== 'admin') window.location.href = '../login_signup.html';

    // Load Data
    document.getElementById('fullName').value = `${session.firstname} ${session.lastname}`;
    document.getElementById('empId').value = session.employee_number;
    document.getElementById('dept').value = session.department;
    document.getElementById('email').value = session.email;
    document.getElementById('contact').value = session.contact_number;

    document.getElementById('accountForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const alertBox = document.getElementById('alertBox');
        const btn = document.querySelector('.btn-save');
        
        // Collect Data
        const data = {
            user_id: session.user_id,
            user_type: 'admin',
            email: document.getElementById('email').value,
            contact_number: document.getElementById('contact').value,
            new_password: document.getElementById('newPass').value,
            current_password: document.getElementById('currentPass').value
        };

        btn.disabled = true; btn.textContent = 'Saving...';

        try {
            const res = await fetch(`${API_BASE}/update_profile.php`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const result = await res.json();

            alertBox.style.display = 'block';
            alertBox.textContent = result.message;
            alertBox.className = `alert ${result.success ? 'alert-success' : 'alert-error'}`;
            
            if(result.success) {
                // Update session storage locally to reflect changes immediately
                session.email = data.email;
                session.contact_number = data.contact_number;
                localStorage.setItem('user_session', JSON.stringify(session));
                document.getElementById('currentPass').value = ''; // Clear pass
                document.getElementById('newPass').value = '';
            }
        } catch(e) {
            alertBox.style.display = 'block';
            alertBox.textContent = "Connection Error";
            alertBox.className = 'alert alert-error';
        }
        btn.disabled = false; btn.textContent = 'Save Changes';
    });

    function logout() {
        if(confirm("Logout?")) {
            localStorage.removeItem('user_session');
            window.location.href = "../login_signup.html";
        }
    }
  </script>
</body>
</html>