<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>University of Makati - ECP Students</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  
  <style>
    /* --- GLOBAL & LAYOUT STYLES --- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Century Gothic', sans-serif;
    }

    body {
      background-color: #f4f5f7;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    /* NAVIGATION BAR */
    nav {
      background-color: #022d6d;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 40px;
      flex-wrap: wrap;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .navbar-left {
      display: flex;
      align-items: center;
      gap: 15px;
      color: white;
      font-size: 16px;
      font-weight: normal;
    }

    .navbar-left img {
      height: 40px;
    }

    .navbar-links {
      list-style: none;
      display: flex;
      gap: 25px;
      align-items: center;
    }

    .navbar-links li a {
      text-decoration: none;
      color: white;
      padding: 10px 20px;
      border-radius: 3px;
      transition: 0.3s;
    }

    .navbar-links li a:hover,
    .navbar-links li a.active-link {
      background-color: #f36b00;
      color: white;
    }

    /* NAV RIGHT - Settings & Logout */
    .nav-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-right .account-link {
      color: #ccc;
      font-size: 12px;
      text-decoration: none;
      border: 1px solid #ccc;
      padding: 5px 10px;
      border-radius: 15px;
      transition: 0.3s;
    }

    .nav-right .account-link:hover {
      color: white;
      border-color: white;
    }
    .logout-btn {
      background-color: #f30000;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 25px;
      cursor: pointer;
      transition: 0.3s;
    }

    .logout-btn:hover {
      background-color: #d00000;
      transform: scale(1.05);
    }

    main {
      flex: 1;
      padding: 40px 60px;
    }

    .section-title {
      font-size: 22px;
      color: #f36b00;
      margin-bottom: 20px;
      font-weight: bold;
    }

    /* --- STATS CARDS --- */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #022d6d 0%, #00509e 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
      font-size: 14px;
      font-weight: normal;
      margin-bottom: 10px;
      opacity: 0.9;
      text-transform: uppercase;
    }

    .stat-card .stat-value {
      font-size: 32px;
      font-weight: bold;
    }

    /* --- SECTIONS & TABLES --- */
    .students-section {
      background-color: white;
      border-radius: 8px;
      padding: 25px 30px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .students-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .students-header h2 {
      color: #f36b00;
      font-weight: bold;
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    .btn-primary {
      background-color: #022d6d;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      cursor: pointer;
      transition: 0.3s;
      font-size: 14px;
    }

    .btn-primary:hover {
      background-color: #00328f;
    }

    .btn-secondary {
      background-color: #f36b00;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      cursor: pointer;
      transition: 0.3s;
      font-size: 14px;
    }

    .btn-secondary:hover {
      background-color: #d45a00;
    }

    /* Export Report Button Style */
    .btn-export-report {
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      cursor: pointer;
      transition: 0.3s;
      font-size: 14px;
    }

    .btn-export-report:hover {
      background-color: #218838;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    /* --- FILTERS & FORMS --- */
    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .filter-item label {
      font-size: 13px;
      color: #022d6d;
      font-weight: bold;
    }

    .filter-item select,
    .filter-item input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      min-width: 150px;
    }

    /* --- TABLE --- */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th, td {
      text-align: left;
      padding: 12px 10px;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #022d6d;
      color: white;
      font-weight: bold;
    }

    tr:hover {
      background-color: #f9f9f9;
    }

    .student-name {
      color: #022d6d;
      font-weight: bold;
    }

    /* --- STATUS BADGES --- */
    .student-status {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-weight: bold;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
    }

    .status-dot {
      height: 8px;
      width: 8px;
      border-radius: 50%;
      display: inline-block;
    }

    .status-active {
      background-color: #d4edda;
      color: #155724;
    }

    .status-inactive {
      background-color: #f8d7da;
      color: #721c24;
    }

    /* --- DROPDOWN MENU --- */
    .action-dropdown {
      position: relative;
      display: inline-block;
    }

    .action-dropdown button {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #022d6d;
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      background-color: white;
      min-width: 120px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      border-radius: 4px;
      z-index: 10;
      right: 0;
    }

    .dropdown-menu a {
      color: #022d6d;
      padding: 10px 15px;
      text-decoration: none;
      display: block;
      font-size: 13px;
    }

    .dropdown-menu a:hover {
      background-color: #f4f5f7;
    }

    /* --- ALERTS --- */
    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid transparent;
      border-radius: 4px;
    }

    .alert-success {
      color: #155724;
      background-color: #d4edda;
      border-color: #c3e6cb;
    }

    .alert-error {
      color: #721c24;
      background-color: #f8d7da;
      border-color: #f5c6cb;
    }

    /* --- FOOTER --- */
    footer {
      background-color: #242424;
      color: #f36b00;
      display: flex;
      justify-content: space-around;
      padding: 40px 20px;
      flex-wrap: wrap;
      margin-top: auto;
    }

    .footer-column {
      max-width: 400px;
    }

    .footer-column h4 {
      margin-bottom: 10px;
      color: #f36b00;
    }

    .footer-column p,
    .footer-column a {
      color: white;
      font-size: 14px;
      line-height: 1.6;
      text-decoration: none;
    }

    .footer-column a:hover {
      color: #f36b00;
      text-decoration: underline;
    }

    /* --- PRINT/PDF SPECIFIC --- */
    @media print {
      nav, 
      .header-actions, 
      .filters, 
      footer, 
      .action-dropdown {
        display: none !important;
      }

      main {
        padding: 0;
        margin: 0;
      }

      .section-title {
        color: black;
      }
    }

    /* --- RESPONSIVE FORM --- */
    @media (max-width: 768px) {
      #studentForm > div {
        grid-template-columns: 1fr !important;
      }

      .filters {
        flex-direction: column;
      }

      .filter-item select,
      .filter-item input {
        width: 100%;
      }
    }
  </style>
</head>

<body>

    <nav>
    <div class="navbar-left">
      <img src="../../images/UMAK LOGO.png" alt="UMak Logo">
      <span>University of Makati - ECP</span>
    </div>

    <ul class="navbar-links">
      <li><a href="admin_dashboard.html" ">Dashboard</a></li>
      <li><a href="#"class="active-link">Students</a></li>
      <li><a href="admin_events.html">Events & Booking</a></li>
      <li><a href="admin_venues.html">Venues</a></li>
      <li><a href="admin_post_evaluations.html">Post-Evaluation</a></li>
      <li><a href="admin_messages.html">Messages</a></li>
    </ul>

    <div class="nav-right">
      <a href="admin_account.html" class="account-link">⚙️ Settings</a>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </nav>

  <main>
    <div class="section-title">Students Management</div>

    <div class="stats-container">
      <div class="stat-card">
        <h3>Total Students</h3>
        <div class="stat-value" id="totalStudents">0</div>
      </div>
      <div class="stat-card">
        <h3>Active Students</h3>
        <div class="stat-value" id="activeStudents">0</div>
      </div>
    </div>

    <div id="alertContainer"></div>

    <div id="studentFormContainer" style="display: none; margin-bottom: 20px;">
      <div class="students-section">
        <div class="students-header">
          <h2 id="formTitle">Add New Student</h2>
          <button class="btn-secondary" onclick="cancelStudentForm()">Cancel</button>
        </div>
        <form id="studentForm">
          <input type="hidden" name="student_id" id="student_id">
          
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
            <div class="filter-item">
              <label>First Name <span style="color: red;">*</span></label>
              <input type="text" name="firstname" id="firstname" required oninput="generateEmail()">
            </div>
            <div class="filter-item">
              <label>Last Name <span style="color: red;">*</span></label>
              <input type="text" name="lastname" id="lastname" required oninput="generateEmail()">
            </div>
            <div class="filter-item">
              <label>Middle Name</label>
              <input type="text" name="middlename" id="middlename">
            </div>
            <div class="filter-item">
              <label>Student Number <span style="color: red;">*</span></label>
              <input type="text" name="student_number" id="student_number" required maxlength="9" oninput="generateEmail()">
            </div>
            <div class="filter-item">
              <label>Email <span style="color: red;">*</span></label>
              <input type="email" name="email" id="email" required readonly style="background-color: #e9ecef; cursor: not-allowed;" title="Auto-generated">
            </div>
            <div class="filter-item">
              <label>Gender <span style="color: red;">*</span></label>
              <select name="gender" id="gender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Non-binary">Non-binary</option>
              </select>
            </div>
            <div class="filter-item">
              <label>College <span style="color: red;">*</span></label>
              <select name="college" id="college" required>
                <option value="">Select College</option>
                <option value="CCIS">CCIS</option>
                <option value="CLAS">CLAS</option>
                <option value="CHK">CHK</option>
                <option value="CBFS">CBFS</option>
                <option value="CITE">CITE</option>
                <option value="CITE-HSU">CITE-HSU</option>
                <option value="CGPP">CGPP</option>
                <option value="CCSE">CCSE</option>
                <option value="CET">CET</option>
                <option value="CTHM">CTHM</option>
                <option value="CCAPS">CCAPS</option>
                <option value="SOL">SOL</option>
                <option value="IAD">IAD</option>
                <option value="IOA">IOA</option>
                <option value="IOP">IOP</option>
                <option value="ION">ION</option>
                <option value="IIHS">IIHS</option>
                <option value="ITEST">ITEST</option>
                <option value="ISDNB">ISDNB</option>
                <option value="IOPsy">IOPsy</option>
                <option value="ISW">ISW</option>
                <option value="IDEM">IDEM</option>
              </select>
            </div>
            <div class="filter-item">
              <label>Course</label>
              <input type="text" name="course" id="course">
            </div>
            <div class="filter-item">
              <label>Year Level</label>
              <select name="year_level" id="year_level">
                <option value="">Select Year</option>
                <option value="1">1st Year</option>
                <option value="2">2nd Year</option>
                <option value="3">3rd Year</option>
                <option value="4">4th Year</option>
              </select>
            </div>
            <div class="filter-item">
              <label>Section</label>
              <input type="text" name="section" id="section">
            </div>
            <div class="filter-item">
              <label>Contact Number</label>
              <input type="text" name="contact_number" id="contact_number" maxlength="11">
            </div>
            <div class="filter-item">
              <label>Password</label>
              <input type="password" name="password" id="password" placeholder="Default: umak123">
              <small style="color:#666; font-size:11px;">Leave blank to keep current password when editing</small>
            </div>
            
            <div class="filter-item" id="statusField" style="display:none;">
                <label>Account Status</label>
                <select name="is_active" id="is_active">
                    <option value="1">Active</option>
                    <option value="0">Inactive</option>
                </select>
            </div>
          </div>
          <div style="text-align: left;">
            <button type="submit" class="btn-primary" id="submitBtn">Save Student</button>
          </div>
        </form>
      </div>
    </div>

    <div class="students-section" id="studentsListSection">
      <div class="students-header">
        <h2>Student List</h2>
        <div class="header-actions">
          <button class="btn-primary" onclick="showAddStudentForm()">Add New Student</button>
          <button class="btn-export-report" onclick="exportToPDF()">Export Report</button>
        </div>
      </div>

      <div class="filters">
        <div class="filter-item">
          <label>College</label>
          <select id="filterCollege" onchange="filterStudents()">
            <option value="all">All Colleges</option>
            <option value="CCIS">CCIS</option>
            <option value="CLAS">CLAS</option>
            <option value="CHK">CHK</option>
            <option value="CBFS">CBFS</option>
            <option value="CITE">CITE</option>
            <option value="CET">CET</option>
            <option value="CTHM">CTHM</option>
          </select>
        </div>
        <div class="filter-item">
          <label>Year Level</label>
          <select id="filterYear" onchange="filterStudents()">
            <option value="all">All Years</option>
            <option value="1">1st Year</option>
            <option value="2">2nd Year</option>
            <option value="3">3rd Year</option>
            <option value="4">4th Year</option>
          </select>
        </div>
        <div class="filter-item">
          <label>Status</label>
          <select id="filterStatus" onchange="filterStudents()">
              <option value="all">All Status</option>
              <option value="1">Active</option>
              <option value="0">Inactive</option>
          </select>
        </div>
        <div class="filter-item">
          <label>Search</label>
          <input type="text" id="searchStudent" placeholder="Search name or number..." onkeyup="filterStudents()">
        </div>
      </div>

      <div id="tableToExport">
          <table id="tblStudents">
            <thead>
              <tr>
                <th>Student #</th>
                <th>Name</th>
                <th>College</th>
                <th>Course</th>
                <th>Year-Section</th>
                <th>Email</th>
                <th>Status</th>
                <th class="actions-col">Actions</th>
              </tr>
            </thead>
            <tbody id="tblBodyStudents">
              <tr><td colspan="8" style="text-align:center; padding: 20px;">Loading students...</td></tr>
            </tbody>
          </table>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-column">
      <h4>About ECP</h4>
      <p>The Event Coordination Portal serves as the central management system for events...</p>
    </div>
    <div class="footer-column">
      <h4>Links</h4>
      <a href="https://www.umak.edu.ph/" target="_blank">University of Makati</a>
    </div>
  </footer>

  <script>
    const API_BASE = '../../api';
    let allStudents = [];
    let isEditMode = false;

    // --- Auto Generate Email Function ---
    function generateEmail() {
        const firstname = document.getElementById('firstname').value.trim();
        const lastname = document.getElementById('lastname').value.trim();
        const studentId = document.getElementById('student_number').value.trim();
        const emailField = document.getElementById('email');

        if (firstname && lastname && studentId) {
            // Format: jframil.a12139502@umak.edu.ph
            // first letter of firstname + lastname + . + studentId + @umak.edu.ph
            const formattedEmail = `${firstname.charAt(0)}${lastname}.${studentId}@umak.edu.ph`.toLowerCase();
            // Remove spaces from email if any
            emailField.value = formattedEmail.replace(/\s+/g, '');
        }
    }

    // --- Export to PDF Function ---
    function exportToPDF() {
        const element = document.getElementById('tableToExport');
        
        // Hide action buttons column for the PDF
        const actionHeaders = element.querySelectorAll('.actions-col');
        const actionCells = element.querySelectorAll('.actions-cell');
        
        actionHeaders.forEach(el => el.style.display = 'none');
        actionCells.forEach(el => el.style.display = 'none');

        const opt = {
            margin:       0.5,
            filename:     'UMak_ECP_Students_Report.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'in', format: 'letter', orientation: 'landscape' }
        };

        // Generate PDF
        html2pdf().set(opt).from(element).save().then(() => {
            // Restore action buttons after export
            actionHeaders.forEach(el => el.style.display = '');
            actionCells.forEach(el => el.style.display = '');
        });
    }

    // --- Utility Functions ---
    async function apiCall(endpoint, method = 'GET', data = null) {
        const options = { method, headers: { 'Content-Type': 'application/json' } };
        if (data && method !== 'GET') options.body = JSON.stringify(data);
        
        try {
            const response = await fetch(`${API_BASE}/${endpoint}`, options);
            const result = await response.json();
            return result;
        } catch (error) {
            console.error('API Error:', error);
            showAlert('Connection error. Ensure XAMPP is running.', 'error');
            return null;
        }
    }

    function showAlert(message, type) {
        const div = document.createElement('div');
        div.className = `alert alert-${type}`;
        div.textContent = message;
        const container = document.getElementById('alertContainer');
        container.innerHTML = '';
        container.appendChild(div);
        setTimeout(() => div.remove(), 4000);
    }

    function toggleDropdown(btn) {
        const menu = btn.nextElementSibling;
        document.querySelectorAll('.dropdown-menu').forEach(el => {
            if(el !== menu) el.style.display = 'none';
        });
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    // --- Main Logic ---
    async function loadStudents() {
        const result = await apiCall('admin_students.php');
        
        if (Array.isArray(result)) {
            allStudents = result;
            filterStudents();
            updateStats();
        } else if (result && result.message) {
            document.getElementById('tblBodyStudents').innerHTML = `<tr><td colspan="8" style="text-align:center; padding:20px;">${result.message}</td></tr>`;
        }
    }

    function renderStudents(list) {
        const tbody = document.getElementById('tblBodyStudents');
        tbody.innerHTML = '';
        
        if (!list.length) {
            tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding:20px;">No students found.</td></tr>';
            return;
        }

        list.forEach(s => {
            const fullName = `${s.lastname}, ${s.firstname} ${s.middlename || ''}`;
            const yearSec = (s.year_level ? s.year_level : '-') + '-' + (s.section || '-');
            
            // Status Logic (1 = Active, 0 = Inactive)
            const isActive = s.is_active == 1;
            const statusText = isActive ? 'Active' : 'Inactive';
            const statusClass = isActive ? 'status-active' : 'status-inactive';
            const dotColor = isActive ? '#155724' : '#721c24';

            const row = document.createElement('tr');
            row.innerHTML = `
                <td><strong>${s.student_number}</strong></td>
                <td class="student-name">${fullName}</td>
                <td>${s.college || '-'}</td>
                <td>${s.course || '-'}</td>
                <td>${yearSec}</td>
                <td>${s.email}</td>
                <td>
                    <span class="student-status ${statusClass}">
                        <span class="status-dot" style="background-color:${dotColor}"></span>
                        ${statusText}
                    </span>
                </td>
                <td class="actions-cell">
                    <div class="action-dropdown">
                        <button onclick="toggleDropdown(this)">⋮</button>
                        <div class="dropdown-menu">
                            <a href="#" onclick="editStudent(${s.student_id}); return false;">Edit</a>
                            <a href="#" onclick="deleteStudent(${s.student_id}); return false;">Delete</a>
                        </div>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    function filterStudents() {
        const college = document.getElementById('filterCollege').value;
        const year = document.getElementById('filterYear').value;
        const statusFilter = document.getElementById('filterStatus').value; // '1', '0', or 'all'
        const search = document.getElementById('searchStudent').value.toLowerCase();

        const filtered = allStudents.filter(s => {
            const matchCollege = college === 'all' || s.college === college;
            const matchYear = year === 'all' || s.year_level == year;
            const matchStatus = statusFilter === 'all' || s.is_active == statusFilter;
            const fullName = `${s.lastname} ${s.firstname}`.toLowerCase();
            const matchSearch = fullName.includes(search) || s.student_number.toLowerCase().includes(search);
            return matchCollege && matchYear && matchStatus && matchSearch;
        });
        
        renderStudents(filtered);
    }

    function updateStats() {
        document.getElementById('totalStudents').textContent = allStudents.length;
        const active = allStudents.filter(s => s.is_active == 1).length;
        document.getElementById('activeStudents').textContent = active;
    }

    // --- Form Handling ---
    function showAddStudentForm() {
        isEditMode = false;
        document.getElementById('formTitle').textContent = 'Add New Student';
        document.getElementById('submitBtn').textContent = 'Add Student';
        document.getElementById('studentForm').reset();
        document.getElementById('student_id').value = '';
        
        document.getElementById('student_number').removeAttribute('readonly');
        document.getElementById('password').value = '';
        document.getElementById('password').placeholder = "Default: umak123";
        
        // Hide Status field in Add mode (default is active)
        document.getElementById('statusField').style.display = 'none';
        
        document.getElementById('studentFormContainer').style.display = 'block';
        document.getElementById('studentsListSection').style.display = 'none';
    }

    function cancelStudentForm() {
        document.getElementById('studentFormContainer').style.display = 'none';
        document.getElementById('studentsListSection').style.display = 'block';
    }

    async function editStudent(id) {
        const result = await apiCall(`admin_students.php?id=${id}`);
        if(result.success) {
            const s = result.data;
            isEditMode = true;
            document.getElementById('formTitle').textContent = 'Edit Student';
            document.getElementById('submitBtn').textContent = 'Update Student';
            
            document.getElementById('student_id').value = s.student_id;
            document.getElementById('lastname').value = s.lastname;
            document.getElementById('firstname').value = s.firstname;
            document.getElementById('middlename').value = s.middlename || '';
            document.getElementById('student_number').value = s.student_number;
            document.getElementById('student_number').setAttribute('readonly', true);
            
            document.getElementById('email').value = s.email;
            document.getElementById('gender').value = s.gender;
            document.getElementById('college').value = s.college;
            document.getElementById('course').value = s.course;
            document.getElementById('year_level').value = s.year_level;
            document.getElementById('section').value = s.section;
            document.getElementById('contact_number').value = s.contact_number;

            document.getElementById('password').value = '';
            document.getElementById('password').placeholder = "Leave blank to keep current";

            // Show Status field in Edit mode
            document.getElementById('statusField').style.display = 'block';
            document.getElementById('is_active').value = s.is_active;

            document.getElementById('studentFormContainer').style.display = 'block';
            document.getElementById('studentsListSection').style.display = 'none';
        }
    }

    document.getElementById('studentForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());
        
        Object.keys(data).forEach(k => { if(data[k] === '') data[k] = null; });

        if(data.password === null) { /* handled by backend */ }

        let result;
        if(isEditMode) {
            result = await apiCall('admin_students.php', 'PUT', data);
        } else {
            delete data.student_id;
            // New students default to Active in backend if is_active not sent
            result = await apiCall('admin_students.php', 'POST', data);
        }

        if(result && (result.success || (result.message && result.message.includes('success')))) {
            showAlert(`Student ${isEditMode ? 'updated' : 'added'} successfully!`, 'success');
            cancelStudentForm();
            loadStudents();
        } else {
            showAlert(result.message || 'Operation failed', 'error');
        }
    });

    async function deleteStudent(id) {
        if(!confirm('Are you sure you want to delete this student?')) return;
        
        const result = await apiCall(`admin_students.php?id=${id}`, 'DELETE');
        if(result && (result.success || result.message.includes('success'))) {
            showAlert('Student deleted.', 'success');
            loadStudents();
        } else {
            showAlert(result.message || 'Delete failed', 'error');
        }
    }

    function logout() {
        if(confirm("Logout?")) window.location.href = "../login_signup.html";
    }

    window.onclick = function(event) {
        if (!event.target.matches('.action-dropdown button')) {
            document.querySelectorAll('.dropdown-menu').forEach(menu => menu.style.display = 'none');
        }
    }

    document.addEventListener('DOMContentLoaded', loadStudents);
  </script>
</body>
</html>